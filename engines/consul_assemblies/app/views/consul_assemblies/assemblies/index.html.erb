<% provide :title do %><%= t('.title') %><% end %>
<% content_for :header_addon do %>
  <%= render "shared/search_form",
             search_path: assemblies_path(page: 1),
             i18n_namespace: "assemblies.index.search_form" %>
<% end %>
<% content_for :canonical do %>
  <%= render "shared/canonical", href: assemblies_url %>
<% end %>

<main>
  <% if @search_terms || @advanced_search_terms || @tag_filter || params[:retired].present? %>
    <div class="highlight no-margin-top padding margin-bottom">
      <div class="row">
        <div class="small-12 column">
          <% if @search_terms || @advanced_search_terms %>
            <h2><%= t("shared.search_results") %></h2>
            <p>
              <%= page_entries_info @assemblies %>
              <% if !@advanced_search_terms %>
                <%= t("assemblies.index.search_results_html", count: @assemblies.size, search_term: @search_terms) %>
              <% end %>
            <p>
          <% elsif @tag_filter %>
            <h2><%= t("shared.search_results") %></h2>
            <p>
              <%= page_entries_info @assemblies %>
              <%= t("assemblies.index.filter_topic", count: @assemblies.size, topic: @tag_filter) %>
            </p>
          <% elsif params[:retired].present? %>
            <h2><%= t("assemblies.index.retired_assemblies") %></h2>
          <% end %>
        </div>
      </div>
    </div>
  <% else %>
    <div class="help-header no-margin-top margin-bottom">
      <div class="row">
        <div class="small-12 column" data-magellan>
          <%= image_tag "help/help_icon_assemblies.png", alt: t("assemblies.index.section_header.icon_alt"), class: "align-top" %>
          <h1 class="inline-block"><%= @assembly_type ?  @assembly_type.name : t("assemblies.index.section_header..title") %></h1>
          <%= link_to t("assemblies.index.section_header.help"), "#section_help", class: "float-right" %>
        </div>
      </div>
    </div>
  <% end %>

  <div class="row">
    <div class="small-12 medium-3 column">
      <aside class="margin-bottom">
        <ul class="menu vertical no-margin-top no-padding-top">
          <% if @assemblies.any? %>
            <% @assemblies.each do |assembly| %>
              <li class="small <%= 'active' if @assembly == assembly %>">
                <%= link_to assembly.name, assemblies_path(assembly_id: assembly, assembly_type_id: assembly.assembly_type_id)  %>
              </li>
            <% end %>
            <% else %>
              <p><%= t(".no_assemblies") %></p>
            <% end %>
        </ul>
      </aside>
    </div>

    <div id="assemblies" class="assemblies-list small-12 medium-9 column">

      <% if has_banners? %>
        <%= render "shared/banner" %>
      <% end %>


      <div id="assemblies-list">

        <% if @meetings %>
          <% if @meetings.any? %>
            <%= render partial: 'meeting', collection: @meetings %>
          <% else %>
            <% if @assembly %>
              <p class="text-muted text-center">
                <br>
                <br>
                No hay asambleas de <u><%= @assembly.name %></u>  programadas
              </p>
            <% end %>
          <% end %>
        <% else %>
          <%= t("assemblies.index.empty") %>
        <% end %>

      </div>
    </div>


  </div>
  <% unless @assembly_type.nil?%>
    <% unless @assembly_type.description.blank?%>
      <div class="row">
        <div class="small-3 column"></div>
        <div class="small-9 column">
          <div id="section_help" class="margin" data-magellan-target="section_help">
            <p class="lead">
              <strong>¿Qué son las asambleas <%= @assembly_type.name %>?</strong>
            </p>
            <p><%= @assembly_type.description %></p>
          </div>
        </div>
      </div>
    <% end %>
  <% end %>
  <% unless @assembly.nil? %>
    <% unless @assembly.general_description.blank? %>
      <div class="row">
        <div class="small-3 column"></div>
        <div class="small-9 column">
          <div id="section_help" class="margin" data-magellan-target="section_help">
            <p class="lead">
              <strong>¿Qué es <%= @assembly.name %>?</strong>
            </p>
            <p><%= @assembly.general_description %></p>
          </div>
        </div>
      </div>
    <% end %>
  <% end %>
</main>
